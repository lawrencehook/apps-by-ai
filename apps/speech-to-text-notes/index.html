<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech to Text Notes - AI Showcase</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #0a0a0f;
            min-height: 100vh;
            color: #e0e0e0;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        h1 { font-size: 1.8rem; margin-bottom: 8px; color: #fff; }
        .subtitle { color: #666; margin-bottom: 32px; }
        .back-link {
            position: fixed; top: 20px; right: 20px; color: #666; text-decoration: none;
            font-size: 14px; padding: 8px 14px; background: rgba(0,0,0,0.85);
            border-radius: 6px; border: 1px solid rgba(255,255,255,0.1);
            z-index: 100;
        }
        .back-link:hover { color: #fff; }

        .status-bar {
            display: flex;
            align-items: center;
            gap: 16px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #666;
            transition: all 0.3s;
        }

        .status-dot.listening {
            background: #ff6b6b;
            box-shadow: 0 0 12px rgba(255, 107, 107, 0.6);
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        .status-text {
            font-size: 0.9rem;
            color: #888;
        }

        .status-text.active {
            color: #ff6b6b;
        }

        .language-select {
            margin-left: auto;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .language-select:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .controls-row {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .record-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 16px 32px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            border: none;
            border-radius: 30px;
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .record-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 107, 107, 0.3);
        }

        .record-btn.recording {
            background: linear-gradient(135deg, #666, #555);
        }

        .record-btn .icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .record-btn.recording .icon {
            border-radius: 3px;
            width: 16px;
            height: 16px;
        }

        .action-btn {
            padding: 14px 24px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .visualizer-container {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .visualizer {
            display: flex;
            align-items: center;
            gap: 3px;
            height: 50px;
        }

        .visualizer-bar {
            width: 4px;
            background: linear-gradient(180deg, #4ecdc4, #44a08d);
            border-radius: 2px;
            transition: height 0.05s ease;
        }

        .notes-container {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            overflow: hidden;
        }

        .notes-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }

        .notes-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            color: #fff;
        }

        .notes-title span {
            font-size: 1.2rem;
        }

        .word-count {
            font-size: 0.85rem;
            color: #666;
        }

        .notes-content {
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            padding: 20px;
        }

        .notes-textarea {
            width: 100%;
            min-height: 280px;
            background: transparent;
            border: none;
            color: #e0e0e0;
            font-size: 1rem;
            line-height: 1.8;
            resize: none;
            font-family: system-ui, -apple-system, sans-serif;
        }

        .notes-textarea:focus {
            outline: none;
        }

        .notes-textarea::placeholder {
            color: #555;
        }

        .live-text {
            color: #4ecdc4;
            font-style: italic;
            opacity: 0.8;
        }

        .timestamp {
            display: inline-block;
            font-size: 0.75rem;
            color: #666;
            background: rgba(255,255,255,0.05);
            padding: 2px 8px;
            border-radius: 10px;
            margin-right: 8px;
        }

        .notes-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            border-top: 1px solid rgba(255,255,255,0.08);
            background: rgba(0,0,0,0.2);
        }

        .auto-save-status {
            font-size: 0.8rem;
            color: #666;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .auto-save-status.saving {
            color: #f1c40f;
        }

        .auto-save-status.saved {
            color: #4ecdc4;
        }

        .export-btns {
            display: flex;
            gap: 8px;
        }

        .export-btn {
            padding: 8px 16px;
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            color: #4ecdc4;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .export-btn:hover {
            background: rgba(78, 205, 196, 0.2);
        }

        .tips-section {
            margin-top: 24px;
            background: rgba(78, 205, 196, 0.05);
            border: 1px solid rgba(78, 205, 196, 0.2);
            border-radius: 12px;
            padding: 20px;
        }

        .tips-title {
            color: #4ecdc4;
            font-size: 0.9rem;
            margin-bottom: 12px;
        }

        .tips-list {
            list-style: none;
            color: #888;
            font-size: 0.85rem;
            line-height: 1.8;
        }

        .tips-list li::before {
            content: "‚Ä¢";
            color: #4ecdc4;
            margin-right: 10px;
        }

        .error-message {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            color: #ff6b6b;
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            display: none;
        }

        .error-message.visible {
            display: block;
        }

        .sessions-list {
            margin-top: 24px;
        }

        .sessions-title {
            font-size: 1rem;
            color: #fff;
            margin-bottom: 12px;
        }

        .session-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .session-item:hover {
            background: rgba(255,255,255,0.05);
        }

        .session-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .session-date {
            font-size: 0.85rem;
            color: #fff;
        }

        .session-preview {
            font-size: 0.8rem;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 400px;
        }

        .session-actions {
            display: flex;
            gap: 8px;
        }

        .session-btn {
            padding: 6px 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #888;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .session-btn:hover {
            color: #fff;
        }

        .session-btn.delete:hover {
            color: #ff6b6b;
            border-color: rgba(255, 107, 107, 0.3);
        }
    </style>
</head>
<body>
    <a href="../../index.html" class="back-link">‚Üê Back</a>

    <div class="container">
        <h1>Speech to Text Notes</h1>
        <p class="subtitle">Real-time voice transcription for meetings, lectures, and quick notes.</p>

        <div class="error-message" id="errorMessage"></div>

        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span class="status-text" id="statusText">Ready</span>
            </div>
            <select class="language-select" id="languageSelect" aria-label="Recognition language">
                <option value="en-US">English (US)</option>
                <option value="en-GB">English (UK)</option>
                <option value="es-ES">Spanish</option>
                <option value="fr-FR">French</option>
                <option value="de-DE">German</option>
                <option value="it-IT">Italian</option>
                <option value="pt-BR">Portuguese</option>
                <option value="ja-JP">Japanese</option>
                <option value="ko-KR">Korean</option>
                <option value="zh-CN">Chinese (Simplified)</option>
            </select>
        </div>

        <div class="controls-row">
            <button class="record-btn" id="recordBtn">
                <div class="icon"></div>
                <span>Start Recording</span>
            </button>
            <button class="action-btn" id="clearBtn">Clear Notes</button>
            <button class="action-btn" id="newSessionBtn">New Session</button>
        </div>

        <div class="visualizer-container">
            <div class="visualizer" id="visualizer"></div>
        </div>

        <div class="notes-container">
            <div class="notes-header">
                <div class="notes-title">
                    <span>üìù</span> Transcription
                </div>
                <div class="word-count" id="wordCount">0 words</div>
            </div>
            <div class="notes-content">
                <textarea class="notes-textarea" id="notesArea" placeholder="Your transcription will appear here...

Click 'Start Recording' and speak clearly into your microphone. The text will be transcribed in real-time.

You can also type or edit the notes manually."></textarea>
            </div>
            <div class="notes-footer">
                <div class="auto-save-status" id="saveStatus">
                    <span>üíæ</span> Auto-saved locally
                </div>
                <div class="export-btns">
                    <button class="export-btn" id="copyBtn">Copy Text</button>
                    <button class="export-btn" id="downloadBtn">Download .txt</button>
                </div>
            </div>
        </div>

        <div class="sessions-list" id="sessionsList">
            <div class="sessions-title">Previous Sessions</div>
            <div id="sessionsContainer"></div>
        </div>

        <div class="tips-section">
            <div class="tips-title">Tips for Better Transcription</div>
            <ul class="tips-list">
                <li>Speak clearly and at a moderate pace</li>
                <li>Use a good quality microphone in a quiet environment</li>
                <li>Allow microphone permission when prompted</li>
                <li>Punctuation is added automatically based on pauses</li>
                <li>Your notes are auto-saved to your browser's local storage</li>
            </ul>
        </div>
    </div>

    <script>
        // Check for browser support
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        let isRecording = false;
        let finalTranscript = '';
        let interimTranscript = '';
        let audioContext = null;
        let analyser = null;
        let microphone = null;
        let animationId = null;

        // DOM Elements
        const recordBtn = document.getElementById('recordBtn');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const notesArea = document.getElementById('notesArea');
        const wordCount = document.getElementById('wordCount');
        const errorMessage = document.getElementById('errorMessage');
        const visualizer = document.getElementById('visualizer');
        const languageSelect = document.getElementById('languageSelect');
        const saveStatus = document.getElementById('saveStatus');

        // Initialize visualizer bars
        function initVisualizer() {
            visualizer.innerHTML = '';
            for (let i = 0; i < 40; i++) {
                const bar = document.createElement('div');
                bar.className = 'visualizer-bar';
                bar.style.height = '4px';
                visualizer.appendChild(bar);
            }
        }

        // Update visualizer with audio data
        function updateVisualizer() {
            if (!analyser) return;

            const dataArray = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(dataArray);

            const bars = visualizer.querySelectorAll('.visualizer-bar');
            const step = Math.floor(dataArray.length / bars.length);

            bars.forEach((bar, i) => {
                const value = dataArray[i * step];
                const height = Math.max(4, (value / 255) * 50);
                bar.style.height = height + 'px';
            });

            if (isRecording) {
                animationId = requestAnimationFrame(updateVisualizer);
            }
        }

        // Initialize audio visualizer
        async function initAudio() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                microphone.connect(analyser);
                analyser.fftSize = 256;
                return true;
            } catch (err) {
                console.error('Audio init error:', err);
                return false;
            }
        }

        // Initialize speech recognition
        function initRecognition() {
            if (!SpeechRecognition) {
                showError('Speech recognition is not supported in your browser. Please use Chrome, Edge, or Safari.');
                recordBtn.disabled = true;
                return false;
            }

            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = languageSelect.value;

            recognition.onstart = () => {
                isRecording = true;
                statusDot.classList.add('listening');
                statusText.classList.add('active');
                statusText.textContent = 'Listening...';
                recordBtn.classList.add('recording');
                recordBtn.querySelector('span').textContent = 'Stop Recording';
                updateVisualizer();
            };

            recognition.onend = () => {
                if (isRecording) {
                    // Restart if still supposed to be recording
                    recognition.start();
                } else {
                    statusDot.classList.remove('listening');
                    statusText.classList.remove('active');
                    statusText.textContent = 'Ready';
                    recordBtn.classList.remove('recording');
                    recordBtn.querySelector('span').textContent = 'Start Recording';
                    cancelAnimationFrame(animationId);
                    resetVisualizerBars();
                }
            };

            recognition.onresult = (event) => {
                interimTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;

                    if (event.results[i].isFinal) {
                        // Add timestamp for longer pauses (new paragraphs)
                        const now = new Date();
                        const timestamp = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                        // Capitalize first letter and add period if missing
                        let processedText = transcript.trim();
                        processedText = processedText.charAt(0).toUpperCase() + processedText.slice(1);

                        if (!/[.!?]$/.test(processedText)) {
                            processedText += '.';
                        }

                        if (finalTranscript && !finalTranscript.endsWith('\n')) {
                            finalTranscript += ' ';
                        }
                        finalTranscript += processedText;
                    } else {
                        interimTranscript += transcript;
                    }
                }

                // Update textarea
                notesArea.value = finalTranscript + (interimTranscript ? ' ' + interimTranscript : '');
                updateWordCount();
                autoSave();
            };

            recognition.onerror = (event) => {
                console.error('Recognition error:', event.error);

                if (event.error === 'not-allowed') {
                    showError('Microphone access denied. Please allow microphone permission and reload the page.');
                    stopRecording();
                } else if (event.error === 'no-speech') {
                    // This is normal, don't show error
                } else {
                    showError('Recognition error: ' + event.error);
                }
            };

            return true;
        }

        function resetVisualizerBars() {
            const bars = visualizer.querySelectorAll('.visualizer-bar');
            bars.forEach(bar => {
                bar.style.height = '4px';
            });
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('visible');
            setTimeout(() => {
                errorMessage.classList.remove('visible');
            }, 5000);
        }

        async function startRecording() {
            if (!recognition) {
                if (!initRecognition()) return;
            }

            recognition.lang = languageSelect.value;

            if (!audioContext) {
                await initAudio();
            }

            try {
                recognition.start();
            } catch (err) {
                console.error('Start error:', err);
            }
        }

        function stopRecording() {
            isRecording = false;
            if (recognition) {
                recognition.stop();
            }
        }

        function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        function updateWordCount() {
            const text = notesArea.value.trim();
            const words = text ? text.split(/\s+/).length : 0;
            wordCount.textContent = words + ' word' + (words !== 1 ? 's' : '');
        }

        let autoSaveTimer = null;
        function autoSave() {
            if (autoSaveTimer) clearTimeout(autoSaveTimer);
            saveStatus.innerHTML = '<span>‚è≥</span> Saving...';
            saveStatus.className = 'auto-save-status saving';

            autoSaveTimer = setTimeout(() => {
                const session = {
                    id: getCurrentSessionId(),
                    text: notesArea.value,
                    date: new Date().toISOString(),
                    language: languageSelect.value
                };

                localStorage.setItem('stt_current_session', JSON.stringify(session));

                saveStatus.innerHTML = '<span>‚úì</span> Saved';
                saveStatus.className = 'auto-save-status saved';
            }, 500);
        }

        function getCurrentSessionId() {
            let sessionId = sessionStorage.getItem('stt_session_id');
            if (!sessionId) {
                sessionId = 'session_' + Date.now();
                sessionStorage.setItem('stt_session_id', sessionId);
            }
            return sessionId;
        }

        function loadCurrentSession() {
            const saved = localStorage.getItem('stt_current_session');
            if (saved) {
                const session = JSON.parse(saved);
                notesArea.value = session.text || '';
                finalTranscript = session.text || '';
                updateWordCount();
            }
        }

        function saveSessionToHistory() {
            const text = notesArea.value.trim();
            if (!text) return;

            const sessions = JSON.parse(localStorage.getItem('stt_sessions') || '[]');
            const session = {
                id: getCurrentSessionId(),
                text: text,
                date: new Date().toISOString(),
                preview: text.substring(0, 100)
            };

            // Don't duplicate
            const existingIndex = sessions.findIndex(s => s.id === session.id);
            if (existingIndex >= 0) {
                sessions[existingIndex] = session;
            } else {
                sessions.unshift(session);
            }

            // Keep only last 10 sessions
            while (sessions.length > 10) sessions.pop();

            localStorage.setItem('stt_sessions', JSON.stringify(sessions));
            renderSessions();
        }

        function newSession() {
            saveSessionToHistory();
            sessionStorage.removeItem('stt_session_id');
            localStorage.removeItem('stt_current_session');
            notesArea.value = '';
            finalTranscript = '';
            interimTranscript = '';
            updateWordCount();
        }

        function renderSessions() {
            const sessions = JSON.parse(localStorage.getItem('stt_sessions') || '[]');
            const container = document.getElementById('sessionsContainer');

            if (sessions.length === 0) {
                container.innerHTML = '<p style="color: #666; font-size: 0.85rem;">No previous sessions</p>';
                return;
            }

            function escapeHtml(str) {
                const div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML;
            }

            container.innerHTML = sessions.map(session => {
                const date = new Date(session.date);
                const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                return `
                    <div class="session-item" data-id="${escapeHtml(session.id)}">
                        <div class="session-info">
                            <div class="session-date">${escapeHtml(dateStr)}</div>
                            <div class="session-preview">${escapeHtml(session.preview)}...</div>
                        </div>
                        <div class="session-actions">
                            <button class="session-btn load-session">Load</button>
                            <button class="session-btn delete">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');

            // Add event listeners
            container.querySelectorAll('.load-session').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = btn.closest('.session-item').dataset.id;
                    loadSession(id);
                });
            });

            container.querySelectorAll('.delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = btn.closest('.session-item').dataset.id;
                    deleteSession(id);
                });
            });
        }

        function loadSession(id) {
            const sessions = JSON.parse(localStorage.getItem('stt_sessions') || '[]');
            const session = sessions.find(s => s.id === id);
            if (session) {
                notesArea.value = session.text;
                finalTranscript = session.text;
                updateWordCount();
            }
        }

        function deleteSession(id) {
            let sessions = JSON.parse(localStorage.getItem('stt_sessions') || '[]');
            sessions = sessions.filter(s => s.id !== id);
            localStorage.setItem('stt_sessions', JSON.stringify(sessions));
            renderSessions();
        }

        function copyToClipboard() {
            const text = notesArea.value;
            if (!text.trim()) {
                showError('Nothing to copy. Record or type some notes first.');
                return;
            }

            const btn = document.getElementById('copyBtn');
            const originalText = btn.textContent;

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    btn.textContent = 'Copied!';
                    setTimeout(() => { btn.textContent = originalText; }, 2000);
                }).catch(() => {
                    // Fallback for clipboard API failure
                    notesArea.select();
                    document.execCommand('copy');
                    btn.textContent = 'Copied!';
                    setTimeout(() => { btn.textContent = originalText; }, 2000);
                });
            } else {
                notesArea.select();
                document.execCommand('copy');
                btn.textContent = 'Copied!';
                setTimeout(() => { btn.textContent = originalText; }, 2000);
            }
        }

        function downloadAsText() {
            const text = notesArea.value;
            if (!text.trim()) {
                showError('Nothing to download. Record or type some notes first.');
                return;
            }

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'transcription_' + new Date().toISOString().slice(0, 10) + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Event listeners
        recordBtn.addEventListener('click', toggleRecording);

        document.getElementById('clearBtn').addEventListener('click', () => {
            if (confirm('Clear all notes? This cannot be undone.')) {
                notesArea.value = '';
                finalTranscript = '';
                interimTranscript = '';
                updateWordCount();
                autoSave();
            }
        });

        document.getElementById('newSessionBtn').addEventListener('click', () => {
            if (notesArea.value.trim() && confirm('Save current session and start new?')) {
                newSession();
            } else if (!notesArea.value.trim()) {
                newSession();
            }
        });

        document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
        document.getElementById('downloadBtn').addEventListener('click', downloadAsText);

        notesArea.addEventListener('input', () => {
            finalTranscript = notesArea.value;
            updateWordCount();
            autoSave();
        });

        languageSelect.addEventListener('change', () => {
            if (recognition && isRecording) {
                recognition.lang = languageSelect.value;
                recognition.stop();
                // Will restart automatically due to onend handler
            }
        });

        // Save session before leaving
        window.addEventListener('beforeunload', () => {
            if (notesArea.value.trim()) {
                saveSessionToHistory();
            }
        });

        // Initialize
        initVisualizer();
        initRecognition();
        loadCurrentSession();
        renderSessions();
        updateWordCount();
    </script>
</body>
</html>
