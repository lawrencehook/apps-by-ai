<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Visualizer - Apps by AI</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #0a0a0f;
            height: 100vh;
            overflow: hidden;
            color: #e0e0e0;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 16px 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            display: flex;
            align-items: baseline;
            gap: 12px;
            margin-bottom: 12px;
        }
        h1 { font-size: 1.4rem; color: #fff; }
        .subtitle { color: #666; font-size: 0.85rem; }
        .back-link {
            position: fixed; top: 12px; right: 12px; color: #666; text-decoration: none;
            font-size: 13px; padding: 6px 12px; background: rgba(0,0,0,0.85);
            border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); z-index: 100;
        }
        .back-link:hover { color: #fff; }
        .controls-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px 16px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 8px;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .control-group label {
            color: #888;
            font-size: 0.8rem;
        }
        select, input[type="number"] {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.15);
            color: #fff;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        input[type="number"] { width: 90px; }
        select:focus, input:focus { outline: none; border-color: #4ecdc4; }
        .btn {
            background: rgba(78, 205, 196, 0.15);
            border: 1px solid rgba(78, 205, 196, 0.3);
            color: #4ecdc4;
            padding: 6px 14px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        .btn:hover { background: rgba(78, 205, 196, 0.25); }
        .btn.secondary {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.15);
            color: #888;
        }
        .btn.secondary:hover { color: #fff; }
        .main-card {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 8px;
            padding: 12px 16px;
            min-height: 0;
        }
        .description {
            color: #888;
            font-size: 0.8rem;
            line-height: 1.4;
            margin-bottom: 8px;
        }
        .visualization {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 0;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
            border-radius: 4px;
        }
        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.08);
        }
        .legend {
            display: flex;
            gap: 16px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: #888;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        .stats {
            display: flex;
            gap: 20px;
        }
        .stat {
            text-align: center;
        }
        .stat-value {
            font-size: 1rem;
            font-weight: 600;
            color: #4ecdc4;
            font-family: 'SF Mono', Monaco, monospace;
        }
        .stat-label {
            font-size: 0.7rem;
            color: #666;
        }
        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        input[type="range"] {
            width: 80px;
            accent-color: #4ecdc4;
        }
    </style>
</head>
<body>
    <a href="../../index.html" class="back-link">← Back</a>
    <div class="container">
        <div class="header">
            <h1>Prime Visualizer</h1>
            <p class="subtitle">Explore prime numbers through beautiful visualizations</p>
        </div>

        <div class="controls-bar">
            <div class="control-group">
                <label>Mode</label>
                <select id="vizType">
                    <option value="ulam">Ulam Spiral</option>
                    <option value="sieve">Sieve of Eratosthenes</option>
                    <option value="gaps">Prime Gaps</option>
                    <option value="grid">Number Grid</option>
                    <option value="sacks">Sacks Spiral</option>
                </select>
            </div>
            <div class="control-group">
                <label>Max</label>
                <input type="number" id="maxNum" value="10000" min="100" max="100000" step="100">
            </div>
            <div class="control-group speed-control" id="speedControl" style="display: none;">
                <label>Speed</label>
                <input type="range" id="speed" min="1" max="100" value="50">
            </div>
            <button class="btn" id="startBtn">Generate</button>
            <button class="btn secondary" id="stopBtn" style="display: none;">Stop</button>
        </div>

        <div class="main-card">
            <div class="description" id="description">
                The <strong>Ulam Spiral</strong> arranges integers in a spiral pattern, highlighting primes. Primes cluster along diagonal lines.
            </div>
            <div class="visualization">
                <canvas id="canvas" width="600" height="600"></canvas>
            </div>
            <div class="footer">
                <div class="legend" id="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4ecdc4;"></div>
                        <span>Prime</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #1a1a2e;"></div>
                        <span>Composite</span>
                    </div>
                </div>
                <div class="stats" id="stats">
                    <div class="stat">
                        <div class="stat-value" id="primeCount">-</div>
                        <div class="stat-label">Primes</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="density">-</div>
                        <div class="stat-label">Density</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="largest">-</div>
                        <div class="stat-label">Largest</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const vizType = document.getElementById('vizType');
        const maxNumInput = document.getElementById('maxNum');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const speedControl = document.getElementById('speedControl');
        const speedInput = document.getElementById('speed');

        let primes = new Set();
        let animationId = null;
        let isRunning = false;

        const descriptions = {
            ulam: 'The <strong>Ulam Spiral</strong> arranges integers in a spiral, highlighting primes. Primes cluster along diagonal lines.',
            sieve: 'The <strong>Sieve of Eratosthenes</strong> finds primes by crossing off multiples of each prime.',
            gaps: '<strong>Prime Gaps</strong> show distances between consecutive primes. Twin primes have a gap of 2.',
            grid: 'A <strong>Number Grid</strong> highlighting primes. Notice how primes become sparser as numbers grow.',
            sacks: 'The <strong>Sacks Spiral</strong> plots numbers on an Archimedean spiral. Primes form curved patterns.'
        };

        function sievePrimes(max) {
            const isPrime = new Array(max + 1).fill(true);
            isPrime[0] = isPrime[1] = false;

            for (let i = 2; i * i <= max; i++) {
                if (isPrime[i]) {
                    for (let j = i * i; j <= max; j += i) {
                        isPrime[j] = false;
                    }
                }
            }

            const result = new Set();
            for (let i = 2; i <= max; i++) {
                if (isPrime[i]) result.add(i);
            }
            return result;
        }

        function updateStats(primeSet, max) {
            const count = primeSet.size;
            const density = ((count / max) * 100).toFixed(2);
            let largest = 0;
            for (const p of primeSet) {
                if (p > largest) largest = p;
            }

            document.getElementById('primeCount').textContent = count.toLocaleString();
            document.getElementById('density').textContent = density + '%';
            document.getElementById('largest').textContent = largest.toLocaleString();
        }

        function drawUlamSpiral(max) {
            primes = sievePrimes(max);
            updateStats(primes, max);

            const size = Math.ceil(Math.sqrt(max));
            const cellSize = Math.min(Math.floor(600 / size), 8);
            const actualSize = size * cellSize;

            canvas.width = actualSize;
            canvas.height = actualSize;

            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, actualSize, actualSize);

            let x = Math.floor(size / 2);
            let y = Math.floor(size / 2);
            let dx = 1, dy = 0;
            let steps = 1, stepCount = 0, turnCount = 0;

            for (let n = 1; n <= max; n++) {
                if (primes.has(n)) {
                    ctx.fillStyle = '#4ecdc4';
                    ctx.fillRect(x * cellSize, y * cellSize, cellSize - 1, cellSize - 1);
                }

                x += dx;
                y += dy;
                stepCount++;

                if (stepCount === steps) {
                    stepCount = 0;
                    turnCount++;
                    [dx, dy] = [-dy, dx]; // Turn left
                    if (turnCount === 2) {
                        turnCount = 0;
                        steps++;
                    }
                }
            }
        }

        function drawSacksSpiral(max) {
            primes = sievePrimes(max);
            updateStats(primes, max);

            canvas.width = 600;
            canvas.height = 600;

            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, 600, 600);

            const centerX = 300;
            const centerY = 300;
            const scale = 280 / Math.sqrt(max);

            for (let n = 1; n <= max; n++) {
                const angle = 2 * Math.PI * Math.sqrt(n);
                const radius = scale * Math.sqrt(n);
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);

                if (primes.has(n)) {
                    ctx.fillStyle = '#4ecdc4';
                    ctx.beginPath();
                    ctx.arc(x, y, Math.max(1, 3 - max / 20000), 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }

        function drawGrid(max) {
            primes = sievePrimes(max);
            updateStats(primes, max);

            const cols = Math.ceil(Math.sqrt(max));
            const rows = Math.ceil(max / cols);
            const cellSize = Math.min(Math.floor(600 / cols), 16);

            canvas.width = cols * cellSize;
            canvas.height = rows * cellSize;

            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let n = 1; n <= max; n++) {
                const col = (n - 1) % cols;
                const row = Math.floor((n - 1) / cols);

                if (primes.has(n)) {
                    ctx.fillStyle = '#4ecdc4';
                } else {
                    ctx.fillStyle = '#1a1a2e';
                }
                ctx.fillRect(col * cellSize, row * cellSize, cellSize - 1, cellSize - 1);
            }
        }

        function drawGaps(max) {
            primes = sievePrimes(max);
            updateStats(primes, max);

            const primeArray = Array.from(primes).sort((a, b) => a - b);
            const gaps = [];

            for (let i = 1; i < primeArray.length; i++) {
                gaps.push({
                    prime: primeArray[i],
                    gap: primeArray[i] - primeArray[i - 1]
                });
            }

            canvas.width = 600;
            canvas.height = 300;

            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, 600, 300);

            const maxGap = Math.max(...gaps.map(g => g.gap));
            const barWidth = Math.max(1, 580 / gaps.length);
            const scale = 260 / maxGap;

            gaps.forEach((g, i) => {
                const height = g.gap * scale;
                const hue = (g.gap / maxGap) * 60; // Yellow to cyan
                ctx.fillStyle = `hsl(${170 - hue}, 70%, 50%)`;
                ctx.fillRect(10 + i * barWidth, 285 - height, barWidth - 0.5, height);
            });

            // Labels
            ctx.fillStyle = '#666';
            ctx.font = '11px system-ui';
            ctx.fillText('Gap size', 10, 14);
            ctx.fillText('Consecutive primes →', 250, 296);
        }

        async function animateSieve(max) {
            isRunning = true;
            stopBtn.style.display = '';
            startBtn.disabled = true;

            const isPrime = new Array(max + 1).fill(true);
            isPrime[0] = isPrime[1] = false;

            const cols = Math.ceil(Math.sqrt(max));
            const rows = Math.ceil(max / cols);
            const cellSize = Math.min(Math.floor(600 / cols), 16);

            canvas.width = cols * cellSize;
            canvas.height = rows * cellSize;

            // Draw initial grid
            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let n = 2; n <= max; n++) {
                const col = (n - 1) % cols;
                const row = Math.floor((n - 1) / cols);
                ctx.fillStyle = '#2a4a48';
                ctx.fillRect(col * cellSize, row * cellSize, cellSize - 1, cellSize - 1);
            }

            const speed = 101 - speedInput.value;
            const batchSize = Math.max(1, Math.floor(max / 500));

            for (let i = 2; i * i <= max && isRunning; i++) {
                if (isPrime[i]) {
                    // Highlight current prime
                    const col = (i - 1) % cols;
                    const row = Math.floor((i - 1) / cols);
                    ctx.fillStyle = '#4ecdc4';
                    ctx.fillRect(col * cellSize, row * cellSize, cellSize - 1, cellSize - 1);

                    // Cross out multiples
                    let count = 0;
                    for (let j = i * i; j <= max && isRunning; j += i) {
                        if (isPrime[j]) {
                            isPrime[j] = false;
                            const mcol = (j - 1) % cols;
                            const mrow = Math.floor((j - 1) / cols);
                            ctx.fillStyle = '#3a2020';
                            ctx.fillRect(mcol * cellSize, mrow * cellSize, cellSize - 1, cellSize - 1);

                            count++;
                            if (count % batchSize === 0) {
                                await new Promise(r => setTimeout(r, speed));
                            }
                        }
                    }
                }
            }

            // Final coloring
            if (isRunning) {
                primes = new Set();
                for (let n = 2; n <= max; n++) {
                    const col = (n - 1) % cols;
                    const row = Math.floor((n - 1) / cols);
                    if (isPrime[n]) {
                        primes.add(n);
                        ctx.fillStyle = '#4ecdc4';
                    } else {
                        ctx.fillStyle = '#1a1a2e';
                    }
                    ctx.fillRect(col * cellSize, row * cellSize, cellSize - 1, cellSize - 1);
                }
                updateStats(primes, max);
            }

            isRunning = false;
            stopBtn.style.display = 'none';
            startBtn.disabled = false;
        }

        function stop() {
            isRunning = false;
        }

        function generate() {
            // Stop any running animation first
            if (isRunning) {
                isRunning = false;
            }

            const type = vizType.value;
            const max = Math.min(100000, Math.max(100, parseInt(maxNumInput.value) || 10000));
            maxNumInput.value = max;

            document.getElementById('description').innerHTML = descriptions[type];

            // Update legend
            const legend = document.getElementById('legend');
            if (type === 'gaps') {
                legend.innerHTML = `
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(90deg, #4ecdc4, #c4a000);"></div>
                        <span>Gap size (small → large)</span>
                    </div>
                `;
            } else if (type === 'sieve') {
                legend.innerHTML = `
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4ecdc4;"></div>
                        <span>Prime</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3a2020;"></div>
                        <span>Crossed out</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #2a4a48;"></div>
                        <span>Unchecked</span>
                    </div>
                `;
            } else {
                legend.innerHTML = `
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4ecdc4;"></div>
                        <span>Prime</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #1a1a2e;"></div>
                        <span>Composite</span>
                    </div>
                `;
            }

            switch (type) {
                case 'ulam':
                    drawUlamSpiral(max);
                    break;
                case 'sacks':
                    drawSacksSpiral(max);
                    break;
                case 'grid':
                    drawGrid(max);
                    break;
                case 'gaps':
                    drawGaps(max);
                    break;
                case 'sieve':
                    animateSieve(max);
                    break;
            }
        }

        vizType.addEventListener('change', () => {
            const isSieve = vizType.value === 'sieve';
            speedControl.style.display = isSieve ? 'flex' : 'none';
            document.getElementById('description').innerHTML = descriptions[vizType.value];
        });

        startBtn.addEventListener('click', generate);
        stopBtn.addEventListener('click', stop);

        // Initial render
        generate();
    </script>
</body>
</html>
